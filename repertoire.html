<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22%230000AA%22>:v</text></svg>">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIR_Œ£500</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text x='16' y='24' font-family='Courier New' font-size='20' font-weight='bold' fill='%230000AA' text-anchor='middle'>:V</text></svg>">
<style>
@keyframes flicker {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.96; }
}

@keyframes scanline {
  0% { transform: translateY(-100%); }
  100% { transform: translateY(100vh); }
}

@keyframes glow {
  0%, 100% { box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.5); }
  50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 4px 4px 0 rgba(0, 0, 0, 0.5); }
}

* {
  cursor: none !important;
  box-sizing: border-box;
}

body {
  background-color: #0000AA;
  color: #FFFFFF;
  font-family: "Courier New", "Lucida Console", monospace;
  font-size: 16px;
  margin: 0;
  padding: 40px;
  min-height: 100vh;
  width: 100vw;
  animation: flicker 0.15s infinite;
  text-shadow: 0 0 2px rgba(255, 255, 255, 0.5);
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(transparent, rgba(255, 255, 255, 0.1), transparent);
  animation: scanline 8s linear infinite;
  pointer-events: none;
  z-index: 1000;
}

body::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: repeating-linear-gradient(
    0deg,
    rgba(0, 0, 0, 0.15),
    rgba(0, 0, 0, 0.15) 1px,
    transparent 1px,
    transparent 2px
  );
  pointer-events: none;
  z-index: 999;
}

.content {
  position: relative;
  z-index: 1;
  max-width: 1400px;
  margin: 0 auto;
}

.logo {

  border: 2px solid #FFFFFF;
  display: inline-block;
  padding: 4px 16px;
  margin-bottom: 30px;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.2s;
}

.logo:hover {
  background: #FFFFFF;
}


.logo span {
  background-color: #FFFFFF;
  color: #0000AA;
  padding: 0 4px;
  font-weight: bold;
  font-size: 18px;
}

.header-section {
  margin-bottom: 30px;
}

.error-header {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 15px;
  letter-spacing: 1px;
}

.system-info {
  font-size: 14px;
  margin-bottom: 20px;
  padding: 10px;
  border: 2px solid #FFFFFF;
  border-style: inset;
  background-color: rgba(0, 0, 100, 0.5);
  box-shadow: inset 1px 1px 0 rgba(0, 0, 0, 0.5);
}

.controls {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
  flex-wrap: wrap;
  align-items: center;
}

.search-box {
  flex: 1;
  min-width: 200px;
  padding: 8px 12px;
  background: #FFFFFF;
  border-top: 2px solid #808080;
  border-left: 2px solid #808080;
  border-bottom: 2px solid #FFFFFF;
  border-right: 2px solid #FFFFFF;
  font-family: "Courier New", monospace;
  font-size: 13px;
  color: #000000;
}

.search-box:focus {
  outline: 2px dotted #000080;
  outline-offset: -4px;
  background: #FFFFCC;
}

.search-box::placeholder {
  color: #808080;
}

.sort-select {
  padding: 8px 12px;
  background: #C0C0C0;
  border-top: 2px solid #FFFFFF;
  border-left: 2px solid #FFFFFF;
  border-bottom: 2px solid #000000;
  border-right: 2px solid #000000;
  font-family: "Courier New", monospace;
  font-size: 13px;
  color: #000000;
  cursor: pointer;
}

.btn-random {
  padding: 8px 16px;
  background: #C0C0C0;
  border-top: 2px solid #FFFFFF;
  border-left: 2px solid #FFFFFF;
  border-bottom: 2px solid #000000;
  border-right: 2px solid #000000;
  font-family: "Courier New", monospace;
  font-weight: bold;
  font-size: 13px;
  color: #000000;
  cursor: pointer;
  box-shadow: 2px 2px 0 #000000;
}

.btn-random:hover {
  background: #DFDFDF;
}

.btn-random:active {
  border-top: 2px solid #000000;
  border-left: 2px solid #000000;
  border-bottom: 2px solid #FFFFFF;
  border-right: 2px solid #FFFFFF;
  box-shadow: inset 1px 1px 2px #000000;
}

.profiles-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.profile-card {
  background: #C0C0C0;
  border-top: 3px solid #FFFFFF;
  border-left: 3px solid #FFFFFF;
  border-bottom: 3px solid #000000;
  border-right: 3px solid #000000;
  padding: 12px;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.5);
  position: relative;
}

.profile-card:hover {
  background: #000080;
  border-top: 3px solid #000000;
  border-left: 3px solid #000000;
  border-bottom: 3px solid #FFFFFF;
  border-right: 3px solid #FFFFFF;
  animation: glow 1s infinite;
  transform: translateY(-2px);
}

.profile-card:hover .profile-name,
.profile-card:hover .profile-type,
.profile-card:hover .profile-desc,
.profile-card:hover .profile-country {
  color: #FFFFFF;
}

.profile-card:active {
  transform: translateY(0);
  box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5);
}

.profile-country {
  position: absolute;
  top: 8px;
  right: 8px;
  font-size: 11px;
  color: #000080;
  font-weight: bold;
  background: rgba(255, 255, 255, 0.7);
  padding: 2px 6px;
  border: 1px solid #000080;
  cursor: help;
}

.profile-country:hover::after {
  content: attr(data-country-name);
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 4px;
  background: #FFFFE1;
  color: #000000;
  padding: 4px 8px;
  border: 2px solid #000000;
  white-space: nowrap;
  font-size: 10px;
  z-index: 1000;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.profile-rank {
  position: absolute;
  top: 8px;
  left: 8px;
  font-size: 10px;
  color: #FFFFFF;
  font-weight: bold;
  background: #FF0000;
  padding: 2px 6px;
  border: 1px solid #000000;
}

.profile-icon {
  width: 80px;
  height: 80px;
  margin: 15px auto 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid #000000;
  background: #FFFFFF;
  overflow: hidden;
  font-size: 32px;
}

.profile-icon img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  image-rendering: pixelated;
}

.profile-name {
  font-size: 14px;
  font-weight: bold;
  color: #000000;
  margin-bottom: 4px;
  text-align: center;
  letter-spacing: 0.5px;
}

.profile-type {
  font-size: 11px;
  color: #000080;
  margin-bottom: 6px;
  text-align: center;
  font-style: italic;
}

.profile-desc {
  font-size: 11px;
  color: #000000;
  line-height: 1.3;
  text-align: center;
}

.fake-cursor {
  position: fixed;
  width: 16px;
  height: 16px;
  background-color: #FFFFFF;
  pointer-events: none;
  z-index: 10000;
  mix-blend-mode: difference;
  display: none;
}

body:hover .fake-cursor {
  display: block;
}

.result-count {
  font-size: 13px;
  color: #AAAAAA;
  margin-top: 10px;
}

.loading {
  text-align: center;
  padding: 50px;
  font-size: 18px;
}

@media (max-width: 768px) {
  body {
    padding: 20px;
  }
  
  .profiles-grid {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
  }
  
  .error-header {
    font-size: 16px;
  }
  
  .controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-box, .btn-random {
    width: 100%;
  }
}
</style>
</head>
<body>

<div class="fake-cursor" id="fakeCursor"></div>

<div class="content">
  <a href="borne.html" style="text-decoration:none;">
    <a href="borne.html" class="logo"><span>:vitalism</span></a>
  </a>
  
  <div class="header-section">
    <div class="error-header">*** DIRECTORY ACCESS: ANON_PROFILES</div>
    <div class="system-info">
      System: DIR_Œ£500 | Status: ACTIVE | Entries: <span id="entryCount">--</span> | Access Level: PUBLIC
    </div>
  </div>

  <div class="controls">
    <input type="text" id="searchBox" class="search-box" placeholder="Rechercher un anone...">
    <select class="sort-select" id="sortBy" onchange="sortProfiles()">
      <option value="name">Trier: Nom</option>
      <option value="score">Trier: Score</option>
      <option value="country">Trier: Pays</option>
      <option value="type">Trier: Sp√©cialit√©</option>
    </select>
    <button class="btn-random" onclick="randomProfile()">üé≤ RANDOM</button>
  </div>

  <div class="result-count" id="resultCount"></div>

  <div class="profiles-grid" id="profilesGrid">
    <div class="loading">Chargement des profils...</div>
  </div>
</div>

<script>
const fakeCursor = document.getElementById('fakeCursor');
document.addEventListener('mousemove', (e) => {
  fakeCursor.style.left = e.clientX + 'px';
  fakeCursor.style.top = e.clientY + 'px';
});

// Mapping des codes pays vers noms complets
const countryNames = {
  'GR': 'Gr√®ce',
  'FR': 'France',
  'AU': 'Australie',
  'NO': 'Norv√®ge',
  'MX': 'Mexique',
  'TR': 'Turquie',
  'IE': 'Irlande',
  'CN': 'Chine',
  'IS': 'Islande',
  'CA': 'Canada',
  'IT': 'Italie',
  'SE': 'Su√®de',
  'RU': 'Russie',
  'EG': '√âgypte',
  'RO': 'Roumanie',
  'DE': 'Allemagne',
  'UK': 'Royaume-Uni',
  '--': 'Inconnu'
};

let allProfiles = [];
let currentProfiles = [];
let rankingData = {};

// Formule de score (identique √† classement.html)
function getArticlePagesPerContributor(name) {
  switch(name) {
    case "Venehon": return 1;
    case "Caverne": return 5;
    case "Raffaello Bellino": return 5;
    default: return 3;
  }
}

function calculateTotalScore(contributor) {
  let totalScore = 0;
  
  for (let y = 2007; y <= 2025; y++) {
    const yearKey = 'y' + y;
    const data = contributor[yearKey];
    if (!data) continue;
    
    // Pages livres
    const yearBooks = (contributor.books || []).filter(b => b.year === y);
    const bookPages = yearBooks.reduce((sum, b) => sum + (b.pages || 0), 0);
    
    // Pages traductions (50%)
    const yearTrans = (contributor.translations || []).filter(t => t.year === y);
    const transPages = yearTrans.reduce((sum, t) => sum + (t.pages || 0), 0);
    
    // Articles
    const yearArticles = (contributor.articles || []).filter(a => a.year === y);
    let articleCount = yearArticles.length || data.articles || 0;
    const pagesPerArticle = getArticlePagesPerContributor(contributor.name);
    const articlePages = articleCount * pagesPerArticle;
    
    totalScore += (bookPages * 16.275) + (transPages * 8.14) + (articlePages * 16.275) + ((data.videos || 0) * 10);
  }
  
  return Math.round(totalScore);
}

// Chargement des donn√©es depuis data.json
async function loadData() {
  try {
    const response = await fetch('data.json');
    const data = await response.json();
    
    // Calculer les scores et cr√©er les profils
    const contributorsWithScores = data.contributors.map(c => ({
      ...c,
      score: calculateTotalScore(c)
    }));
    
    // Trier par score pour le rang
    contributorsWithScores.sort((a, b) => b.score - a.score);
    
    // Cr√©er les profils avec le rang
    allProfiles = contributorsWithScores.map((c, idx) => ({
      name: c.name,
      type: c.type,
      desc: c.description,
      avatar: c.avatar || null,
      url: c.file,
      country: c.country,
      rank: idx + 1,
      score: c.score,
      alias: c.alias
    }));
    
    currentProfiles = [...allProfiles];
    
    document.getElementById('entryCount').textContent = allProfiles.length;
    
    // Appliquer le tri initial selon le select
    sortProfiles();
    
  } catch (error) {
    console.error('Erreur de chargement:', error);
    document.getElementById('profilesGrid').innerHTML = '<div class="loading" style="color: #FF0000;">*** ERREUR DE CHARGEMENT ***</div>';
  }
}

function renderProfiles(profilesToRender = currentProfiles) {
  const grid = document.getElementById('profilesGrid');
  const resultCount = document.getElementById('resultCount');
  
  grid.innerHTML = '';
  
  profilesToRender.forEach(profile => {
    const card = document.createElement('div');
    card.className = 'profile-card';
    card.onclick = () => window.location.href = profile.url;
    
    const countryName = countryNames[profile.country] || profile.country;
    
    let avatarContent = '‚ùì';
    if (profile.avatar) {
      avatarContent = `<img src="${profile.avatar}" alt="${profile.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='‚ùì';">`;
    }
    
    card.innerHTML = `
      <div class="profile-rank">#${profile.rank}</div>
      <div class="profile-country" data-country-name="${countryName}">${profile.country}</div>
      <div class="profile-icon">${avatarContent}</div>
      <div class="profile-name">${profile.name}</div>
      <div class="profile-type">${profile.type}</div>
      <div class="profile-desc">${profile.desc}</div>
    `;
    
    grid.appendChild(card);
  });
  
  resultCount.textContent = `${profilesToRender.length} profils actifs trouv√©s`;
}

function sortProfiles() {
  const sortBy = document.getElementById('sortBy').value;
  
  currentProfiles = [...allProfiles];
  
  // Options pour le tri fran√ßais (accents, insensible √† la casse)
  const collator = new Intl.Collator('fr', { sensitivity: 'base', numeric: true });
  
  switch(sortBy) {
    case 'name':
      currentProfiles.sort((a, b) => collator.compare(a.name, b.name));
      break;
    case 'score':
      currentProfiles.sort((a, b) => b.score - a.score);
      break;
    case 'country':
      currentProfiles.sort((a, b) => collator.compare(a.country, b.country));
      break;
    case 'type':
      currentProfiles.sort((a, b) => collator.compare(a.type, b.type));
      break;
  }
  
  renderProfiles();
}

function searchProfiles() {
  const query = document.getElementById('searchBox').value.toLowerCase();
  
  if (!query) {
    renderProfiles(currentProfiles);
    return;
  }
  
  const filtered = currentProfiles.filter(profile => 
    profile.name.toLowerCase().includes(query) ||
    profile.type.toLowerCase().includes(query) ||
    profile.desc.toLowerCase().includes(query) ||
    profile.country.toLowerCase().includes(query) ||
    (profile.alias && profile.alias.toLowerCase().includes(query))
  );
  
  renderProfiles(filtered);
}

function randomProfile() {
  const activeProfiles = allProfiles.filter(p => p.url && p.url !== '#');
  if (activeProfiles.length > 0) {
    const random = activeProfiles[Math.floor(Math.random() * activeProfiles.length)];
    window.location.href = random.url;
  } else {
    alert('*** ERREUR: AUCUN PROFIL ACTIF DISPONIBLE ***');
  }
}

document.getElementById('searchBox').addEventListener('input', searchProfiles);

document.getElementById('searchBox').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    searchProfiles();
  }
});

// Charger les donn√©es au d√©marrage
loadData();
</script>

</body>
</html>
